# .env file
# Copy this file to .env and configure for your backup mode

# --- Global Mode Switch ---
# Choose backup mode: sql (pg_dump backups) or wal (wal-g incremental backups)
BACKUP_MODE=sql

# --- General Settings ---
# Timezone for the container and cron job (e.g., Asia/Shanghai, UTC, America/New_York)
TZ=Asia/Shanghai

# Default superuser and password. CHANGE THE PASSWORD!
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_very_strong_superuser_password

# --- Docker Configuration Based on Mode ---
# For SQL mode (default):
# These are used when BACKUP_MODE=sql

# Base64 encoded content of your rclone.conf file
# Run: cat ~/.config/rclone/rclone.conf | base64 -w0
RCLONE_CONFIG_BASE64=PASTE_YOUR_BASE64_ENCODED_RCLONE_CONFIG_HERE

# Rclone remote path (e.g., mydrive:database_backups/postgres)
REMOTE_PATH=your_rclone_remote:path/to/all_db_backups

# Your AGE public key for encryption
AGE_PUBLIC_KEY=PASTE_YOUR_AGE_PUBLIC_KEY_HERE

# How many days to keep the SQL dumps on the rclone remote
SQL_BACKUP_RETAIN_DAYS=30

# Script will be executed every day at 2:00 AM
BACKUP_CRON_SCHEDULE="0 2 * * *"

# For WAL mode:
# --- WAL Mode Configuration (wal-g over SSH) ---
# These are used when BACKUP_MODE=wal
# SSH remote path for wal-g (omit port; set WALG_SSH_PORT below to avoid double-port parsing issues)
WALG_SSH_PREFIX=ssh://walg@your-backup-host/absolute/path/to/backup/directory

# SSH port for wal-g backend (if not standard 22)
SSH_PORT=22

# SSH private key for authentication (base64 encoded)
# Run: cat ~/.ssh/id_walg | base64 -w0
WALG_SSH_PRIVATE_KEY=PASTE_YOUR_BASE64_ENCODED_SSH_PRIVATE_KEY_HERE

# Alternative: Path to SSH private key file (will be mounted as volume)
WALG_SSH_PRIVATE_KEY_PATH=/secrets/walg_ssh_key
SSH_KEY_PATH=./secrets/walg_ssh_key

# wal-g compression method
WALG_COMPRESSION_METHOD=lz4

# Maximum delta backup steps (incremental chain length)
WALG_DELTA_MAX_STEPS=7

# Delta backup origin
WALG_DELTA_ORIGIN=LATEST

# Log level for wal-g (NORMAL or DEVEL)
WALG_LOG_LEVEL=DEVEL

# Retention policy: number of full backups to keep
WALG_RETENTION_FULL=7

# Retention policy: days to keep (alternative/additional)
WALG_RETENTION_DAYS=30

# Cron schedule for base backups (when BACKUP_MODE=wal)
WALG_BASEBACKUP_CRON="30 1 * * *"

# Cron schedule for cleanup (when BACKUP_MODE=wal)
WALG_CLEAN_CRON="15 3 * * *"

# --- Local SSH Server for Testing (Optional) ---
# ENABLE_SSH_SERVER=1: 自动启用内部 ssh-server (docker compose --profile ssh-testing)，
# 并使用默认: WALG_SSH_PREFIX=ssh://walg@ssh-server/backups  SSH_PORT=2222  SSH_USER=walg
# ENABLE_SSH_SERVER=0: 需要自行提供一个可访问的 WALG_SSH_PREFIX (例如外部机器)
# WALG_SSH_PREFIX 在 ENABLE_SSH_SERVER=1 时可留空，会被自动填入默认值
ENABLE_SSH_SERVER=0

# SSH user for test server (留空则会从 WALG_SSH_PREFIX 推断；仅在需要覆盖时设置)
SSH_USER=

# (Deprecated) WALG_SSH_PREFIX_LOCAL 现已弃用，统一使用 WALG_SSH_PREFIX。
# WALG_SSH_PREFIX_LOCAL=ssh://walg@ssh-server/backups

# --- pgAdmin Settings ---
# pgAdmin (database administration tool) runs on port 8080
# Admin credentials for initial setup (change these for security!)
PGADMIN_DEFAULT_EMAIL=admin@admin.com
PGADMIN_DEFAULT_PASSWORD=admin

# --- Telegram Notifications (Optional) ---
TELEGRAM_BOT_TOKEN=PASTE_YOUR_TELEGRAM_BOT_TOKEN_HERE
TELEGRAM_CHAT_ID=PASTE_YOUR_TELEGRAM_CHAT_ID_HERE
TELEGRAM_MESSAGE_PREFIX=Database
