# .env file
# Rename it to .env before running docker

# --- Global Mode Switch ---
# Choose backup mode: sql (current mechanism) or wal (wal-g incremental)
BACKUP_MODE=sql

# For wal mode, you need to set these Docker Compose overrides:
# POSTGRES_IMAGE=  (leave empty to build custom)
# POSTGRES_DOCKERFILE=Dockerfile.postgres-walg
# BACKUP_VOLUME_MODE=ro  (for wal mode, backup container only reads)

# --- PostgreSQL Credentials ---
# Default superuser and password. CHANGE THE PASSWORD!
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_very_strong_superuser_password

# --- SQL Mode Backup Configuration (legacy) ---
# These are used when BACKUP_MODE=sql
# Base64 encoded content of your rclone.conf file
# Run: cat ~/.config/rclone/rclone.conf | base64 -w0
RCLONE_CONFIG_BASE64=PASTE_YOUR_BASE64_ENCODED_RCLONE_CONFIG_HERE

# Your AGE public key for encryption
AGE_PUBLIC_KEY=PASTE_YOUR_AGE_PUBLIC_KEY_HERE

# Rclone remote path (e.g., mydrive:database_backups/postgres)
REMOTE_PATH=your_rclone_remote:path/to/all_db_backups

# How many days to keep the SQL dumps on the rclone remote
SQL_BACKUP_RETAIN_DAYS=30

# --- WAL Mode Configuration (wal-g over SSH) ---
# These are used when BACKUP_MODE=wal
# SSH remote path for wal-g (omit port; set WALG_SSH_PORT below to avoid double-port parsing issues)
WALG_SSH_PREFIX=ssh://walg@your-backup-host/absolute/path/to/backup/directory

# SSH port for wal-g backend (if not standard 22)
SSH_PORT=22

# SSH private key for authentication (base64 encoded)
# Run: cat ~/.ssh/id_walg | base64 -w0
WALG_SSH_PRIVATE_KEY=PASTE_YOUR_BASE64_ENCODED_SSH_PRIVATE_KEY_HERE

# Alternative: Path to SSH private key file (will be mounted as volume)
WALG_SSH_PRIVATE_KEY_PATH=/secrets/walg_ssh_key
SSH_KEY_PATH=./secrets/walg_ssh_key

# wal-g compression method
WALG_COMPRESSION_METHOD=lz4

# Maximum delta backup steps (incremental chain length)
WALG_DELTA_MAX_STEPS=7

# Delta backup origin
WALG_DELTA_ORIGIN=LATEST

# Log level for wal-g (NORMAL or DEVEL)
WALG_LOG_LEVEL=DEVEL

# Retention policy: number of full backups to keep
WALG_RETENTION_FULL=7

# Cron schedule for base backups (when BACKUP_MODE=wal)
WALG_BASEBACKUP_CRON="30 1 * * *"

# Cron schedule for cleanup (when BACKUP_MODE=wal)
WALG_CLEAN_CRON="15 3 * * *"

# --- Local SSH Server for Testing (Optional) ---
# Set to 1 to enable local SSH server for wal-g testing
ENABLE_SSH_SERVER=0

# SSH user for the local test server  
SSH_USER=walg

# --- Telegram Notifications (Optional) ---
TELEGRAM_BOT_TOKEN=PASTE_YOUR_TELEGRAM_BOT_TOKEN_HERE
TELEGRAM_CHAT_ID=PASTE_YOUR_TELEGRAM_CHAT_ID_HERE
TELEGRAM_MESSAGE_PREFIX=Database

# --- General Settings ---
# Timezone for the container and cron job (e.g., Asia/Shanghai, UTC, America/New_York)
TZ=Asia/Shanghai

# --- CRON Settings ---
# Script will be executed every day at 2:00 AM
BACKUP_CRON_SCHEDULE="0 2 * * *"

# --- pgAdmin Settings ---
# pgAdmin (database administration tool) runs on port 8080
# Admin credentials for initial setup (change these for security!)
PGADMIN_DEFAULT_EMAIL=admin@admin.com
PGADMIN_DEFAULT_PASSWORD=admin
